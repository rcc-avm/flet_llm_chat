#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
"""

import sys
import os
sys.path.append('src')

from utils.cache import ChatCache

def test_auth():
    cache = ChatCache()

    print("–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...")

    # –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    cache.clear_auth_data()
    print("‚úì –î–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—á–∏—â–µ–Ω—ã")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
    data = cache.get_auth_data()
    if data is None:
        print("‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—à–ª–∞")
    else:
        print("‚úó –û–∂–∏–¥–∞–ª–æ—Å—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö")
        return False

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PIN
    pin = cache.generate_pin()
    print(f"‚úì –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω PIN: {pin}")

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    test_key = "sk-or-v1-test-key-123456789"
    cache.save_auth_data(test_key, pin)
    print("‚úì –î–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã")

    # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    data = cache.get_auth_data()
    if data and data['api_key'] == test_key:
        print("‚úì –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ")
    else:
        print("‚úó –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è API –∫–ª—é—á–∞")
        return False

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ PIN
    if cache.verify_pin(pin):
        print("‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ PIN –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ")
    else:
        print("‚úó –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ PIN")
        return False

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ PIN
    if not cache.verify_pin("0000"):
        print("‚úì –ù–µ–≤–µ—Ä–Ω—ã–π PIN –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É")
    else:
        print("‚úó –ù–µ–≤–µ—Ä–Ω—ã–π PIN –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É (–æ—à–∏–±–∫–∞)")
        return False

    print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
    return True

if __name__ == "__main__":
    test_auth()
